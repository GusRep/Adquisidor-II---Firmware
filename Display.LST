A51 MACRO ASSEMBLER  DISPLAY                                                              08/30/2007 21:25:42 PAGE     1


MACRO ASSEMBLER A51 V7.04a
OBJECT MODULE PLACED IN Display.OBJ
ASSEMBLER INVOKED BY: C:\SiLabs\MCU\IDEfiles\C51\BIN\a51.exe Display.asm XR GEN DB EP NOMOD51

LOC  OBJ            LINE     SOURCE

                       1     ;$include (C8051F340.inc)
                +1     2     ;------------------------------------------------------------------------------
                +1     3     ; C8051F340.INC
                +1     4     ;------------------------------------------------------------------------------
                +1     5     ; Copyright 2005 Silicon Laboratories, Inc.
                +1     6     ; http://www.silabs.com
                +1     7     ;
                +1     8     ; Program Description:
                +1     9     ;
                +1    10     ; Register/bit definitions for the C8051F34x family.
                +1    11     ;
                +1    12     ;
                +1    13     ; FID:            34X000003
                +1    14     ; Target:         C8051F340, 'F341, 'F342, 'F343, 'F344, 'F345, 'F346, 'F347
                +1    15     ; Tool chain:     Keil
                +1    16     ; Command Line:   None
                +1    17     ;
                +1    18     ; Release 1.0
                +1    19     ;    -Initial Revision (GP\PKC)
                +1    20     ;    -13 DEC 2005
                +1    21     ;
                +1    22     
                +1    23     ;------------------------------------------------------------------------------
                +1    24     ; Byte Registers
                +1    25     ;------------------------------------------------------------------------------
                +1    26     
  0080          +1    27     P0        DATA  080H                   ; Port 0 Latch
  0081          +1    28     SP        DATA  081H                   ; Stack Pointer
  0082          +1    29     DPL       DATA  082H                   ; Data Pointer Low
  0083          +1    30     DPH       DATA  083H                   ; Data Pointer High
  0084          +1    31     EMI0TC    DATA  084H                   ; External Memory Interface Timing
  0085          +1    32     EMI0CF    DATA  085H                   ; External Memory Interface Config
  0086          +1    33     OSCLCN    DATA  086H                   ; Internal Low-Freq Oscillator Control
  0087          +1    34     PCON      DATA  087H                   ; Power Control
  0088          +1    35     TCON      DATA  088H                   ; Timer/Counter Control
  0089          +1    36     TMOD      DATA  089H                   ; Timer/Counter Mode
  008A          +1    37     TL0       DATA  08AH                   ; Timer/Counter 0 Low
  008B          +1    38     TL1       DATA  08BH                   ; Timer/Counter 1 Low
  008C          +1    39     TH0       DATA  08CH                   ; Timer/Counter 0 High
  008D          +1    40     TH1       DATA  08DH                   ; Timer/Counter 1 High
  008E          +1    41     CKCON     DATA  08EH                   ; Clock Control
  008F          +1    42     PSCTL     DATA  08FH                   ; Program Store R/W Control
  0090          +1    43     P1        DATA  090H                   ; Port 1 Latch
  0091          +1    44     TMR3CN    DATA  091H                   ; Timer/Counter 3Control
  0092          +1    45     TMR3RLL   DATA  092H                   ; Timer/Counter 3 Reload Low
  0093          +1    46     TMR3RLH   DATA  093H                   ; Timer/Counter 3 Reload High
  0094          +1    47     TMR3L     DATA  094H                   ; Timer/Counter 3Low
  0095          +1    48     TMR3H     DATA  095H                   ; Timer/Counter 3 High
  0096          +1    49     USB0ADR   DATA  096H                   ; USB0 Indirect Address Register
  0097          +1    50     USB0DAT   DATA  097H                   ; USB0 Data Register
  0098          +1    51     SCON0     DATA  098H                   ; UART0 Control
  0099          +1    52     SBUF0     DATA  099H                   ; UART0 Data Buffer
  009A          +1    53     CPT1CN    DATA  09AH                   ; Comparator1 Control
  009B          +1    54     CPT0CN    DATA  09BH                   ; Comparator0 Control
  009C          +1    55     CPT1MD    DATA  09CH                   ; Comparator1 Mode Selection
  009D          +1    56     CPT0MD    DATA  09DH                   ; Comparator0 Mode Selection
  009E          +1    57     CPT1MX    DATA  09EH                   ; Comparator1 MUX Selection
  009F          +1    58     CPT0MX    DATA  09FH                   ; Comparator0 MUX Selection
A51 MACRO ASSEMBLER  DISPLAY                                                              08/30/2007 21:25:42 PAGE     2

  00A0          +1    59     P2        DATA  0A0H                   ; Port 2 Latch
  00A1          +1    60     SPI0CFG   DATA  0A1H                   ; SPI Configuration
  00A2          +1    61     SPI0CKR   DATA  0A2H                   ; SPI Clock Rate Control
  00A3          +1    62     SPI0DAT   DATA  0A3H                   ; SPI Data
  00A4          +1    63     P0MDOUT   DATA  0A4H                   ; Port 0 Output Mode Configuration
  00A5          +1    64     P1MDOUT   DATA  0A5H                   ; Port 1 Output Mode Configuration
  00A6          +1    65     P2MDOUT   DATA  0A6H                   ; Port 2 Output Mode Configuration
  00A7          +1    66     P3MDOUT   DATA  0A7H                   ; Port 3 Output Mode Configuration
  00A8          +1    67     IE        DATA  0A8H                   ; Interrupt Enable
  00A9          +1    68     CLKSEL    DATA  0A9H                   ; Clock Select
  00AA          +1    69     EMI0CN    DATA  0AAH                   ; External Memory Interface Control
  00AC          +1    70     SBCON1    DATA  0ACH                   ; UART1 Baud Rate Generator Control
  00AE          +1    71     P4MDOUT   DATA  0AEH                   ; Port 4 Output Mode Configuration
  00AF          +1    72     PFE0CN    DATA  0AFH                   ; Prefetch Engine Control
  00B0          +1    73     P3        DATA  0B0H                   ; Port 3 Latch
  00B1          +1    74     OSCXCN    DATA  0B1H                   ; External Oscillator Control
  00B2          +1    75     OSCICN    DATA  0B2H                   ; Internal Oscillator Control
  00B3          +1    76     OSCICL    DATA  0B3H                   ; Internal Oscillator Calibration
  00B4          +1    77     SBRLL1    DATA  0B4H                   ; UART1 Baud Rate Generator Low
  00B5          +1    78     SBRLH1    DATA  0B5H                   ; UART1 Baud Rate Generator High
  00B6          +1    79     FLSCL     DATA  0B6H                   ; Flash Scale
  00B7          +1    80     FLKEY     DATA  0B7H                   ; Flash Lock and Key
  00B8          +1    81     IP        DATA  0B8H                   ; Interrupt Priority
  00B9          +1    82     CLKMUL    DATA  0B9H                   ; Clock Multiplier
  00BA          +1    83     AMX0N     DATA  0BAH                   ; AMUX0 Negative Channel Select
  00BB          +1    84     AMX0P     DATA  0BBH                   ; AMUX0 Positive Channel Select
  00BC          +1    85     ADC0CF    DATA  0BCH                   ; ADC0 Configuration
  00BD          +1    86     ADC0L     DATA  0BDH                   ; ADC0 Low
  00BE          +1    87     ADC0H     DATA  0BEH                   ; ADC0 High
  00C0          +1    88     SMB0CN    DATA  0C0H                   ; SMBus Control
  00C1          +1    89     SMB0CF    DATA  0C1H                   ; SMBus Configuration
  00C2          +1    90     SMB0DAT   DATA  0C2H                   ; SMBus Data
  00C3          +1    91     ADC0GTL   DATA  0C3H                   ; ADC0 Greater-Than Compare Low
  00C4          +1    92     ADC0GTH   DATA  0C4H                   ; ADC0 Greater-Than Compare High
  00C5          +1    93     ADC0LTL   DATA  0C5H                   ; ADC0 Less-Than Compare Word Low
  00C6          +1    94     ADC0LTH   DATA  0C6H                   ; ADC0 Less-Than Compare Word High
  00C7          +1    95     P4        DATA  0C7H                   ; Port 4 Latch
  00C8          +1    96     TMR2CN    DATA  0C8H                   ; Timer/Counter 2 Control
  00C9          +1    97     REG0CN    DATA  0C9H                   ; Voltage Regulator Control
  00CA          +1    98     TMR2RLL   DATA  0CAH                   ; Timer/Counter 2 Reload Low
  00CB          +1    99     TMR2RLH   DATA  0CBH                   ; Timer/Counter 2 Reload High
  00CC          +1   100     TMR2L     DATA  0CCH                   ; Timer/Counter 2 Low
  00CD          +1   101     TMR2H     DATA  0CDH                   ; Timer/Counter 2 High
  00D0          +1   102     PSW       DATA  0D0H                   ; Program Status Word
  00D1          +1   103     REF0CN    DATA  0D1H                   ; Voltage Reference Control
  00D2          +1   104     SCON1     DATA  0D2H                   ; UART1 Control
  00D3          +1   105     SBUF1     DATA  0D3H                   ; UART1 Data Buffer
  00D4          +1   106     P0SKIP    DATA  0D4H                   ; Port 0 Skip
  00D5          +1   107     P1SKIP    DATA  0D5H                   ; Port 1 Skip
  00D6          +1   108     P2SKIP    DATA  0D6H                   ; Port 2 Skip
  00D7          +1   109     USB0XCN   DATA  0D7H                   ; USB0 Transceiver Control
  00D8          +1   110     PCA0CN    DATA  0D8H                   ; PCA Control
  00D9          +1   111     PCA0MD    DATA  0D9H                   ; PCA Mode
  00DA          +1   112     PCA0CPM0  DATA  0DAH                   ; PCA Module 0 Mode Register
  00DB          +1   113     PCA0CPM1  DATA  0DBH                   ; PCA Module 1 Mode Register
  00DC          +1   114     PCA0CPM2  DATA  0DCH                   ; PCA Module 2 Mode Register
  00DD          +1   115     PCA0CPM3  DATA  0DDH                   ; PCA Module 3 Mode Register
  00DE          +1   116     PCA0CPM4  DATA  0DEH                   ; PCA Module 4 Mode Register
  00DF          +1   117     P3SKIP    DATA  0DFH                   ; Port 3Skip
  00E0          +1   118     ACC       DATA  0E0H                   ; Accumulator
  00E1          +1   119     XBR0      DATA  0E1H                   ; Port I/O Crossbar Control 0
  00E2          +1   120     XBR1      DATA  0E2H                   ; Port I/O Crossbar Control 1
  00E3          +1   121     XBR2      DATA  0E3H                   ; Port I/O Crossbar Control 2
  00E4          +1   122     IT01CF    DATA  0E4H                   ; INT0/INT1 Configuration
  00E5          +1   123     SMOD1     DATA  0E5H                   ; UART1 Mode
  00E6          +1   124     EIE1      DATA  0E6H                   ; Extended Interrupt Enable 1
A51 MACRO ASSEMBLER  DISPLAY                                                              08/30/2007 21:25:42 PAGE     3

  00E7          +1   125     EIE2      DATA  0E7H                   ; Extended Interrupt Enable 2
  00E8          +1   126     ADC0CN    DATA  0E8H                   ; ADC0 Control
  00E9          +1   127     PCA0CPL1  DATA  0E9H                   ; PCA Capture 1 Low
  00EA          +1   128     PCA0CPH1  DATA  0EAH                   ; PCA Capture 1 High
  00EB          +1   129     PCA0CPL2  DATA  0EBH                   ; PCA Capture 2 Low
  00EC          +1   130     PCA0CPH2  DATA  0ECH                   ; PCA Capture 2 High
  00ED          +1   131     PCA0CPL3  DATA  0EDH                   ; PCA Capture 3 Low
  00EE          +1   132     PCA0CPH3  DATA  0EEH                   ; PCA Capture 3High
  00EF          +1   133     RSTSRC    DATA  0EFH                   ; Reset Source Configuration/Status
  00F0          +1   134     B         DATA  0F0H                   ; B Register
  00F1          +1   135     P0MDIN    DATA  0F1H                   ; Port 0 Input Mode Configuration
  00F2          +1   136     P1MDIN    DATA  0F2H                   ; Port 1 Input Mode Configuration
  00F3          +1   137     P2MDIN    DATA  0F3H                   ; Port 2 Input Mode Configuration
  00F4          +1   138     P3MDIN    DATA  0F4H                   ; Port 3 Input Mode Configuration
  00F5          +1   139     P4MDIN    DATA  0F5H                   ; Port 4 Input Mode Configuration
  00F6          +1   140     EIP1      DATA  0F6H                   ; Extended Interrupt Priority 1
  00F7          +1   141     EIP2      DATA  0F7H                   ; Extended Interrupt Priority 2
  00F8          +1   142     SPI0CN    DATA  0F8H                   ; SPI Control
  00F9          +1   143     PCA0L     DATA  0F9H                   ; PCA Counter Low
  00FA          +1   144     PCA0H     DATA  0FAH                   ; PCA Counter High
  00FB          +1   145     PCA0CPL0  DATA  0FBH                   ; PCA Capture 0 Low
  00FC          +1   146     PCA0CPH0  DATA  0FCH                   ; PCA Capture 0 High
  00FD          +1   147     PCA0CPL4  DATA  0FDH                   ; PCA Capture 4 Low
  00FE          +1   148     PCA0CPH4  DATA  0FEH                   ; PCA Capture 4 High
  00FF          +1   149     VDM0CN    DATA  0FFH                   ; VDD Monitor Control
                +1   150     
                +1   151     ;------------------------------------------------------------------------------
                +1   152     ; Bit Definitions
                +1   153     ;------------------------------------------------------------------------------
                +1   154     
                +1   155     ; TCON  088H
  008F          +1   156     TF1     BIT     TCON.7                 ; Timer1 overflow flag
  008E          +1   157     TR1     BIT     TCON.6                 ; Timer1 on/off control
  008D          +1   158     TF0     BIT     TCON.5                 ; Timer0 overflow flag
  008C          +1   159     TR0     BIT     TCON.4                 ; Timer0 on/off control
  008B          +1   160     IE1     BIT     TCON.3                 ; Ext. Interrupt 1 edge flag
  008A          +1   161     IT1     BIT     TCON.2                 ; Ext. Interrupt 1 type
  0089          +1   162     IE0     BIT     TCON.1                 ; Ext. Interrupt 0 edge flag
  0088          +1   163     IT0     BIT     TCON.0                 ; Ext. Interrupt 0 type
                +1   164     
                +1   165     ; SCON0  098H
  009F          +1   166     S0MODE  BIT     SCON0.7                ; Serial mode control bit 0
                +1   167                                            ; Bit 6 unused
  009D          +1   168     MCE0    BIT     SCON0.5                ; Multiprocessor communication enable
  009C          +1   169     REN0    BIT     SCON0.4                ; Receive enable
  009B          +1   170     TB80    BIT     SCON0.3                ; Transmit bit 8
  009A          +1   171     RB80    BIT     SCON0.2                ; Receive bit 8
  0099          +1   172     TI0     BIT     SCON0.1                ; Transmit interrupt flag
  0098          +1   173     RI0     BIT     SCON0.0                ; Receive interrupt flag
                +1   174     
                +1   175     ; IE  0A8H
  00AF          +1   176     EA      BIT     IE.7                   ; Global interrupt enable
  00AE          +1   177     ESPI0   BIT     IE.6                   ; Bit 6 unused
  00AD          +1   178     ET2     BIT     IE.5                   ; Bit 5 unused
  00AC          +1   179     ES0     BIT     IE.4                   ; UART0 interrupt enable
  00AB          +1   180     ET1     BIT     IE.3                   ; Timer1 interrupt enable
  00AA          +1   181     EX1     BIT     IE.2                   ; External interrupt 1 enable
  00A9          +1   182     ET0     BIT     IE.1                   ; Timer0 interrupt enable
  00A8          +1   183     EX0     BIT     IE.0                   ; External interrupt 0 enable
                +1   184     
                +1   185     ; IP  0B8H
                +1   186                                            ; Bit 7 unused
  00BE          +1   187     PSPI0   BIT     IP.6                   ; SPI0 interrupt priority
  00BD          +1   188     PT2     BIT     IP.5                   ; Timer2 priority
  00BC          +1   189     PS0     BIT     IP.4                   ; UART0 priority
  00BB          +1   190     PT1     BIT     IP.3                   ; Timer1 priority
A51 MACRO ASSEMBLER  DISPLAY                                                              08/30/2007 21:25:42 PAGE     4

  00BA          +1   191     PX1     BIT     IP.2                   ; External interrupt 1 priority
  00B9          +1   192     PT0     BIT     IP.1                   ; Timer0 priority
  00B8          +1   193     PX0     BIT     IP.0                   ; External interrupt 0 priority
                +1   194     
                +1   195     ; SMB0CN  0C0H
  00C7          +1   196     MASTER  BIT     SMB0CN.7               ; Master/slave indicator
  00C6          +1   197     TXMODE  BIT     SMB0CN.6               ; Transmit mode indicator
  00C5          +1   198     STA     BIT     SMB0CN.5               ; Start flag
  00C4          +1   199     STO     BIT     SMB0CN.4               ; Stop flag
  00C3          +1   200     ACKRQ   BIT     SMB0CN.3               ; Acknowledge request
  00C2          +1   201     ARBLOST BIT     SMB0CN.2               ; Arbitration lost indicator
  00C1          +1   202     ACK     BIT     SMB0CN.1               ; Acknowledge flag
  00C0          +1   203     SI      BIT     SMB0CN.0               ; SMBus interrupt flag
                +1   204     
                +1   205     ; TMR2CN  0C8H
  00CF          +1   206     TF2H    BIT     TMR2CN.7               ; Timer2 high byte overflow flag
  00CE          +1   207     TF2L    BIT     TMR2CN.6               ; Timer2 low byte overflow flag
  00CD          +1   208     TF2LEN  BIT     TMR2CN.5               ; Timer2 low byte interrupt enable
  00CC          +1   209     T2CE    BIT     TMR2CN.4               ; Timer2 capture enable
  00CB          +1   210     T2SPLIT BIT     TMR2CN.3               ; Timer2 split mode enable
  00CA          +1   211     TR2     BIT     TMR2CN.2               ; Timer2 on/off control
  00C9          +1   212     T2CSS   BIT     TMR2CN.1               ; Timer 2 Capture Source select
  00C8          +1   213     T2XCLK  BIT     TMR2CN.0               ; Timer2 external clock select
                +1   214     
                +1   215     ; PSW  0D0H
  00D7          +1   216     CY      BIT     PSW.7                  ; Carry flag
  00D6          +1   217     AC      BIT     PSW.6                  ; Auxiliary carry flag
  00D5          +1   218     F0      BIT     PSW.5                  ; User flag 0
  00D4          +1   219     RS1     BIT     PSW.4                  ; Register bank select 1
  00D3          +1   220     RS0     BIT     PSW.3                  ; Register bank select 0
  00D2          +1   221     OV      BIT     PSW.2                  ; Overflow flag
  00D1          +1   222     F1      BIT     PSW.1                  ; User flag 1
  00D0          +1   223     P       BIT     PSW.0                  ; Accumulator parity flag
                +1   224     
                +1   225     ; PCA0CN  0D8H
  00DF          +1   226     CF      BIT     PCA0CN.7               ; PCA0 counter overflow flag
  00DE          +1   227     CR      BIT     PCA0CN.6               ; PCA0 counter run control
                +1   228                                            ; Bit5 UNUSED
  00DC          +1   229     CCF4    BIT     PCA0CN.4               ; PCA0 module4 capture/compare flag
  00DB          +1   230     CCF3    BIT     PCA0CN.3               ; PCA0 module3 capture/compare flag
  00DA          +1   231     CCF2    BIT     PCA0CN.2               ; PCA0 module2 capture/compare flag
  00D9          +1   232     CCF1    BIT     PCA0CN.1               ; PCA0 module1 capture/compare flag
  00D8          +1   233     CCF0    BIT     PCA0CN.0               ; PCA0 module0 capture/compare flag
                +1   234     
                +1   235     ; ADC0CN  0E8H
  00EF          +1   236     AD0EN   BIT     ADC0CN.7               ; ADC0 enable
  00EE          +1   237     AD0TM   BIT     ADC0CN.6               ; ADC0 track mode
  00ED          +1   238     AD0INT  BIT     ADC0CN.5               ; ADC0 converision complete interrupt flag
  00EC          +1   239     AD0BUSY BIT     ADC0CN.4               ; ADC0 busy flag
  00EB          +1   240     AD0WINT BIT     ADC0CN.3               ; ADC0 window compare interrupt flag
  00EA          +1   241     AD0CM2  BIT     ADC0CN.2               ; ADC0 conversion mode select 2
  00E9          +1   242     AD0CM1  BIT     ADC0CN.1               ; ADC0 conversion mode select 1
  00E8          +1   243     AD0CM0  BIT     ADC0CN.0               ; ADC0 conversion mode select 0
                +1   244     
                +1   245     ; SPI0CN  0F8H
  00FF          +1   246     SPIF    BIT     SPI0CN.7               ; SPI0 interrupt flag
  00FE          +1   247     WCOL    BIT     SPI0CN.6               ; SPI0 write collision flag
  00FD          +1   248     MODF    BIT     SPI0CN.5               ; SPI0 mode fault flag
  00FC          +1   249     RXOVRN  BIT     SPI0CN.4               ; SPI0 rx overrun flag
  00FB          +1   250     NSSMD1  BIT     SPI0CN.3               ; SPI0 slave select mode 1
  00FA          +1   251     NSSMD0  BIT     SPI0CN.2               ; SPI0 slave select mode 0
  00F9          +1   252     TXBMT   BIT     SPI0CN.1               ; SPI0 transmit buffer empty
  00F8          +1   253     SPIEN   BIT     SPI0CN.0               ; SPI0 SPI enable
                +1   254     
                +1   255     ;------------------------------------------------------------------------------
                +1   256     ; End Of File
A51 MACRO ASSEMBLER  DISPLAY                                                              08/30/2007 21:25:42 PAGE     5

                +1   257     ;------------------------------------------------------------------------------
                     258     
                     259     
                     260     
                     261     ;---------------CONSTANTES-------------------------  
                     262     
  0094               263     DB4     EQU   P1.4                      ;bit 4 del bus de datos
  0095               264     DB5     EQU   P1.5                      ;bit 5 del bus de datos
  0096               265     DB6     EQU   P1.6                      ;bit 6 del bus de datos
  0097               266     DB7     EQU   P1.7                      ;bit 7 del bus de datos
                     267     
  00B7               268     RS      EQU   P3.7                      ;selección de registro de datos (1) o de instrucció
                             n (0)
  00B6               269     RW      EQU   P3.6                      ;selección de escritura (0) o lectura (1)
  00B5               270     EN      EQU   P3.5                      ;habilitación
  00B7               271     BKL                     EQU   P3.7                      ;control de luz de fondo
                     272     
  0090               273     DATO    EQU   P1                        ;port de datos
                     274     ;---------------FIN CONSTANTES---------------------  
                     275     
0000                 276                     org             0
0000 2100            277                     ajmp    inicio
                     278     
                     279     
0100                 280                     org             100h
0100                 281     inicio:
                     282     
                     283     ;---------------SETEOS-------------------------  
0100 75A401          284         mov  P0MDOUT,   #001h
0103 75D403          285         mov  P0SKIP,    #003h
0106 75E240          286         mov  XBR1,      #040h
0109                 287     prueba3:
0109 B280            288     CPL     p0.0
010B B281            289     CPL     p0.1
010D B282            290     CPL     p0.2
010F 80F8            291     sjmp prueba3
                     292     
                     293     
                     294     
                     295     ;    mov  P0MDOUT,   #008h
                     296     ;    mov  P1MDOUT,   #00Fh
                     297     ;    mov  P3MDOUT,   #0F0h
0111 75E102          298         mov  XBR0,      #002h
0114 75E240          299         mov  XBR1,      #040h
                     300     
0117                 301     Oscillator_Init:
0117 75B283          302         mov  OSCICN,    #083h
                     303     
011A                 304     PCA_Init:
011A 53D9BF          305         anl  PCA0MD,    #0BFh
011D 75D900          306         mov  PCA0MD,    #000h
                     307     
                     308     
                     309     ;-----------PROGRAMA--------------------------- 
                     310     
0120 12016C          311                             LCALL           INIT_LCD
0123 1201A9          312                             LCALL           hello
                     313     
0126                 314     espera:
0126 2126            315                             AJMP            espera
                     316     
                     317     
                     318     
                     319     ;-------------------------------------
                     320     
0128                 321           READ_2_NIBBLES:
A51 MACRO ASSEMBLER  DISPLAY                                                              08/30/2007 21:25:42 PAGE     6

0128 4390F0          322            ORL   DATO,#0F0h     ;Be sure to release DATOlines (set outputlatches 
                     323                                ;to '1') so we can read the LCD
012B D2B5            324            SETB  EN
012D E590            325            MOV  A,DATO                      ;Read first part of the return value (high nibble)
012F C2B5            326            CLR   EN
0131 54F0            327            ANL  A,#0F0h         ;Only high nibble is usable
0133 C0E0            328            PUSH  ACC
0135 D2B5            329            SETB  EN
0137 E590            330            MOV   A,DATO        ;Read second part of the return value (low nibble)
0139 C2B5            331            CLR   EN 
013B 54F0            332            ANL   A,#0F0h       ;Only high nibble is usable
013D C4              333            SWAP  A             ;Last received is actually low nibble, so put it in place
013E FF              334            MOV   R7,A 
013F D0E0            335            POP   ACC 
0141 4F              336            ORL   A,R7          ;And combine it with low nibble
0142 22              337            RET
                     338      
                     339      ;-------------------------------------
                     340     
0143                 341           WRITE_2_NIBBLES:
0143 C0E0            342            PUSH  ACC           ;Save A for low nibble
0145 4390F0          343            ORL   DATO,#0F0h    ;Bits 4..7 <- 1
0148 440F            344            ORL   A,#0Fh        ;Don't affect bits 0-3
014A 5290            345            ANL   DATO,A        ;High nibble to display
014C D2B5            346            SETB  EN 
014E C2B5            347            CLR   EN 
0150 D0E0            348            POP   ACC           ;Prepare to send
0152 C4              349            SWAP  A             ;...second nibble
0153 4390F0          350            ORL   DATO,#0F0h    ; Bits 4...7 <- 1
0156 440F            351            ORL   A,#0Fh       ; Don't affect bits 0...3
0158 5290            352            ANL   DATO,A        ;Low nibble to display
015A D2B5            353            SETB  EN 
015C C2B5            354            CLR   EN 
015E 22              355            RET
                     356            
                     357     
                     358     ;-------------------------------------
                     359     
015F                 360           WAIT_LCD:
015F C2B7            361             CLR RS ;It's a command
0161 D2B6            362             SETB RW ;It's a read command
0163 120128          363             LCALL READ_2_NIBBLES ;Take two nibbles from LCD in A
0166 20E7F6          364             JB ACC.7,WAIT_LCD ;If bit 7 high, LCD still busy
0169 C2B6            365             CLR RW ;Turn off RW for future commands
016B 22              366             RET
                     367     
                     368     ;-------------------------------------
                     369     ;INICIALIZACION
                     370     
016C                 371           INIT_LCD:
016C C2B7            372            CLR   RS
016E C2B6            373            CLR   RW
0170 C2B5            374            CLR   EN
0172 D2B5            375            SETB  EN
0174 759028          376            MOV   DATO,#28h
0177 C2B5            377            CLR   EN
0179 12015F          378            LCALL WAIT_LCD
017C 7428            379            MOV   A,#28h
017E 120143          380            LCALL WRITE_2_NIBBLES
0181 12015F          381            LCALL WAIT_LCD
0184 740E            382            MOV   A,#0Eh
0186 120143          383            LCALL WRITE_2_NIBBLES
0189 12015F          384            LCALL WAIT_LCD
018C 7406            385            MOV   A,#06h
018E 120143          386            LCALL WRITE_2_NIBBLES
0191 12015F          387            LCALL WAIT_LCD
A51 MACRO ASSEMBLER  DISPLAY                                                              08/30/2007 21:25:42 PAGE     7

0194 22              388            RET
                     389            
                     390     ;-------------------------------------
                     391     ;CLEARING THE DISPLAY
                     392     
0195                 393           CLEAR_LCD:
0195 C2B7            394            CLR   RS
0197 7401            395            MOV   A,#01h
0199 120143          396            LCALL WRITE_2_NIBBLES ;Write A as two separate nibbles to LCD
019C 12015F          397            LCALL WAIT_LCD
019F 22              398            RET
                     399     
                     400     ;-------------------------------------       
                     401     ;WRITING TEXT TO THE LCD
                     402     
01A0                 403           WRITE_TEXT:
01A0 D2B7            404            SETB  RS
01A2 120143          405            LCALL WRITE_2_NIBBLES
01A5 12015F          406            LCALL WAIT_LCD
01A8 22              407            RET
                     408     
                     409            
                     410     ;-------------------------------------
                     411     
                     412     ;THE "HELLO WORLD" PROGRAM
                     413     
                     414     
01A9                 415     hello:
01A9 12016C          416            LCALL INIT_LCD
01AC 120195          417            LCALL CLEAR_LCD
01AF 7448            418            MOV A,#'H'
01B1 1201A0          419            LCALL WRITE_TEXT
01B4 7445            420            MOV A,#'E'
01B6 1201A0          421            LCALL WRITE_TEXT
01B9 744C            422            MOV A,#'L'
01BB 1201A0          423            LCALL WRITE_TEXT
01BE 744C            424            MOV A,#'L'
01C0 1201A0          425            LCALL WRITE_TEXT
01C3 744F            426            MOV A,#'O'
01C5 1201A0          427            LCALL WRITE_TEXT
01C8 7420            428            MOV A,#' '
01CA 1201A0          429            LCALL WRITE_TEXT
01CD 7457            430            MOV A,#'W'
01CF 1201A0          431            LCALL WRITE_TEXT
01D2 744F            432            MOV A,#'O'
01D4 1201A0          433            LCALL WRITE_TEXT
01D7 7452            434            MOV A,#'R'
01D9 1201A0          435            LCALL WRITE_TEXT
01DC 744C            436            MOV A,#'L'
01DE 1201A0          437            LCALL WRITE_TEXT
01E1 7444            438            MOV A,#'D'
01E3 1201A0          439            LCALL WRITE_TEXT
                     440     
01E6 22              441            RET
                     442     
                     443     ;-------------------------------------
                     444     
                     445     
                     446     
                     447     
                     448     ;===============================================
                     449     END
A51 MACRO ASSEMBLER  DISPLAY                                                              08/30/2007 21:25:42 PAGE     8

XREF SYMBOL TABLE LISTING
---- ------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES / REFERENCES

AC . . . . . . . .  B ADDR   00D0H.6 A      217#
ACC. . . . . . . .  D ADDR   00E0H   A      118# 328 335 342 348 364
ACK. . . . . . . .  B ADDR   00C0H.1 A      202#
ACKRQ. . . . . . .  B ADDR   00C0H.3 A      200#
AD0BUSY. . . . . .  B ADDR   00E8H.4 A      239#
AD0CM0 . . . . . .  B ADDR   00E8H.0 A      243#
AD0CM1 . . . . . .  B ADDR   00E8H.1 A      242#
AD0CM2 . . . . . .  B ADDR   00E8H.2 A      241#
AD0EN. . . . . . .  B ADDR   00E8H.7 A      236#
AD0INT . . . . . .  B ADDR   00E8H.5 A      238#
AD0TM. . . . . . .  B ADDR   00E8H.6 A      237#
AD0WINT. . . . . .  B ADDR   00E8H.3 A      240#
ADC0CF . . . . . .  D ADDR   00BCH   A      85#
ADC0CN . . . . . .  D ADDR   00E8H   A      126# 236 237 238 239 240 241 242 243
ADC0GTH. . . . . .  D ADDR   00C4H   A      92#
ADC0GTL. . . . . .  D ADDR   00C3H   A      91#
ADC0H. . . . . . .  D ADDR   00BEH   A      87#
ADC0L. . . . . . .  D ADDR   00BDH   A      86#
ADC0LTH. . . . . .  D ADDR   00C6H   A      94#
ADC0LTL. . . . . .  D ADDR   00C5H   A      93#
AMX0N. . . . . . .  D ADDR   00BAH   A      83#
AMX0P. . . . . . .  D ADDR   00BBH   A      84#
ARBLOST. . . . . .  B ADDR   00C0H.2 A      201#
B. . . . . . . . .  D ADDR   00F0H   A      134#
BKL. . . . . . . .  B ADDR   00B0H.7 A      271#
CCF0 . . . . . . .  B ADDR   00D8H.0 A      233#
CCF1 . . . . . . .  B ADDR   00D8H.1 A      232#
CCF2 . . . . . . .  B ADDR   00D8H.2 A      231#
CCF3 . . . . . . .  B ADDR   00D8H.3 A      230#
CCF4 . . . . . . .  B ADDR   00D8H.4 A      229#
CF . . . . . . . .  B ADDR   00D8H.7 A      226#
CKCON. . . . . . .  D ADDR   008EH   A      41#
CLEAR_LCD. . . . .  C ADDR   0195H   A      393# 417
CLKMUL . . . . . .  D ADDR   00B9H   A      82#
CLKSEL . . . . . .  D ADDR   00A9H   A      68#
CPT0CN . . . . . .  D ADDR   009BH   A      54#
CPT0MD . . . . . .  D ADDR   009DH   A      56#
CPT0MX . . . . . .  D ADDR   009FH   A      58#
CPT1CN . . . . . .  D ADDR   009AH   A      53#
CPT1MD . . . . . .  D ADDR   009CH   A      55#
CPT1MX . . . . . .  D ADDR   009EH   A      57#
CR . . . . . . . .  B ADDR   00D8H.6 A      227#
CY . . . . . . . .  B ADDR   00D0H.7 A      216#
DATO . . . . . . .  D ADDR   0090H   A      273# 322 325 330 343 345 350 352 376
DB4. . . . . . . .  B ADDR   0090H.4 A      263#
DB5. . . . . . . .  B ADDR   0090H.5 A      264#
DB6. . . . . . . .  B ADDR   0090H.6 A      265#
DB7. . . . . . . .  B ADDR   0090H.7 A      266#
DPH. . . . . . . .  D ADDR   0083H   A      30#
DPL. . . . . . . .  D ADDR   0082H   A      29#
EA . . . . . . . .  B ADDR   00A8H.7 A      176#
EIE1 . . . . . . .  D ADDR   00E6H   A      124#
EIE2 . . . . . . .  D ADDR   00E7H   A      125#
EIP1 . . . . . . .  D ADDR   00F6H   A      140#
EIP2 . . . . . . .  D ADDR   00F7H   A      141#
EMI0CF . . . . . .  D ADDR   0085H   A      32#
EMI0CN . . . . . .  D ADDR   00AAH   A      69#
EMI0TC . . . . . .  D ADDR   0084H   A      31#
EN . . . . . . . .  B ADDR   00B0H.5 A      270# 324 326 329 331 346 347 353 354 374 375 377
ES0. . . . . . . .  B ADDR   00A8H.4 A      179#
A51 MACRO ASSEMBLER  DISPLAY                                                              08/30/2007 21:25:42 PAGE     9

ESPERA . . . . . .  C ADDR   0126H   A      314# 315
ESPI0. . . . . . .  B ADDR   00A8H.6 A      177#
ET0. . . . . . . .  B ADDR   00A8H.1 A      182#
ET1. . . . . . . .  B ADDR   00A8H.3 A      180#
ET2. . . . . . . .  B ADDR   00A8H.5 A      178#
EX0. . . . . . . .  B ADDR   00A8H.0 A      183#
EX1. . . . . . . .  B ADDR   00A8H.2 A      181#
F0 . . . . . . . .  B ADDR   00D0H.5 A      218#
F1 . . . . . . . .  B ADDR   00D0H.1 A      222#
FLKEY. . . . . . .  D ADDR   00B7H   A      80#
FLSCL. . . . . . .  D ADDR   00B6H   A      79#
HELLO. . . . . . .  C ADDR   01A9H   A      312 415#
IE . . . . . . . .  D ADDR   00A8H   A      67# 176 177 178 179 180 181 182 183
IE0. . . . . . . .  B ADDR   0088H.1 A      162#
IE1. . . . . . . .  B ADDR   0088H.3 A      160#
INICIO . . . . . .  C ADDR   0100H   A      277 281#
INIT_LCD . . . . .  C ADDR   016CH   A      311 371# 416
IP . . . . . . . .  D ADDR   00B8H   A      81# 187 188 189 190 191 192 193
IT0. . . . . . . .  B ADDR   0088H.0 A      163#
IT01CF . . . . . .  D ADDR   00E4H   A      122#
IT1. . . . . . . .  B ADDR   0088H.2 A      161#
MASTER . . . . . .  B ADDR   00C0H.7 A      196#
MCE0 . . . . . . .  B ADDR   0098H.5 A      168#
MODF . . . . . . .  B ADDR   00F8H.5 A      248#
NSSMD0 . . . . . .  B ADDR   00F8H.2 A      251#
NSSMD1 . . . . . .  B ADDR   00F8H.3 A      250#
OSCICL . . . . . .  D ADDR   00B3H   A      76#
OSCICN . . . . . .  D ADDR   00B2H   A      75# 302
OSCILLATOR_INIT. .  C ADDR   0117H   A      301#
OSCLCN . . . . . .  D ADDR   0086H   A      33#
OSCXCN . . . . . .  D ADDR   00B1H   A      74#
OV . . . . . . . .  B ADDR   00D0H.2 A      221#
P. . . . . . . . .  B ADDR   00D0H.0 A      223#
P0 . . . . . . . .  D ADDR   0080H   A      27# 288 289 290
P0MDIN . . . . . .  D ADDR   00F1H   A      135#
P0MDOUT. . . . . .  D ADDR   00A4H   A      63# 284
P0SKIP . . . . . .  D ADDR   00D4H   A      106# 285
P1 . . . . . . . .  D ADDR   0090H   A      43# 263 264 265 266 273
P1MDIN . . . . . .  D ADDR   00F2H   A      136#
P1MDOUT. . . . . .  D ADDR   00A5H   A      64#
P1SKIP . . . . . .  D ADDR   00D5H   A      107#
P2 . . . . . . . .  D ADDR   00A0H   A      59#
P2MDIN . . . . . .  D ADDR   00F3H   A      137#
P2MDOUT. . . . . .  D ADDR   00A6H   A      65#
P2SKIP . . . . . .  D ADDR   00D6H   A      108#
P3 . . . . . . . .  D ADDR   00B0H   A      73# 268 269 270 271
P3MDIN . . . . . .  D ADDR   00F4H   A      138#
P3MDOUT. . . . . .  D ADDR   00A7H   A      66#
P3SKIP . . . . . .  D ADDR   00DFH   A      117#
P4 . . . . . . . .  D ADDR   00C7H   A      95#
P4MDIN . . . . . .  D ADDR   00F5H   A      139#
P4MDOUT. . . . . .  D ADDR   00AEH   A      71#
PCA0CN . . . . . .  D ADDR   00D8H   A      110# 226 227 229 230 231 232 233
PCA0CPH0 . . . . .  D ADDR   00FCH   A      146#
PCA0CPH1 . . . . .  D ADDR   00EAH   A      128#
PCA0CPH2 . . . . .  D ADDR   00ECH   A      130#
PCA0CPH3 . . . . .  D ADDR   00EEH   A      132#
PCA0CPH4 . . . . .  D ADDR   00FEH   A      148#
PCA0CPL0 . . . . .  D ADDR   00FBH   A      145#
PCA0CPL1 . . . . .  D ADDR   00E9H   A      127#
PCA0CPL2 . . . . .  D ADDR   00EBH   A      129#
PCA0CPL3 . . . . .  D ADDR   00EDH   A      131#
PCA0CPL4 . . . . .  D ADDR   00FDH   A      147#
PCA0CPM0 . . . . .  D ADDR   00DAH   A      112#
PCA0CPM1 . . . . .  D ADDR   00DBH   A      113#
PCA0CPM2 . . . . .  D ADDR   00DCH   A      114#
A51 MACRO ASSEMBLER  DISPLAY                                                              08/30/2007 21:25:42 PAGE    10

PCA0CPM3 . . . . .  D ADDR   00DDH   A      115#
PCA0CPM4 . . . . .  D ADDR   00DEH   A      116#
PCA0H. . . . . . .  D ADDR   00FAH   A      144#
PCA0L. . . . . . .  D ADDR   00F9H   A      143#
PCA0MD . . . . . .  D ADDR   00D9H   A      111# 305 306
PCA_INIT . . . . .  C ADDR   011AH   A      304#
PCON . . . . . . .  D ADDR   0087H   A      34#
PFE0CN . . . . . .  D ADDR   00AFH   A      72#
PRUEBA3. . . . . .  C ADDR   0109H   A      287# 291
PS0. . . . . . . .  B ADDR   00B8H.4 A      189#
PSCTL. . . . . . .  D ADDR   008FH   A      42#
PSPI0. . . . . . .  B ADDR   00B8H.6 A      187#
PSW. . . . . . . .  D ADDR   00D0H   A      102# 216 217 218 219 220 221 222 223
PT0. . . . . . . .  B ADDR   00B8H.1 A      192#
PT1. . . . . . . .  B ADDR   00B8H.3 A      190#
PT2. . . . . . . .  B ADDR   00B8H.5 A      188#
PX0. . . . . . . .  B ADDR   00B8H.0 A      193#
PX1. . . . . . . .  B ADDR   00B8H.2 A      191#
RB80 . . . . . . .  B ADDR   0098H.2 A      171#
READ_2_NIBBLES . .  C ADDR   0128H   A      321# 363
REF0CN . . . . . .  D ADDR   00D1H   A      103#
REG0CN . . . . . .  D ADDR   00C9H   A      97#
REN0 . . . . . . .  B ADDR   0098H.4 A      169#
RI0. . . . . . . .  B ADDR   0098H.0 A      173#
RS . . . . . . . .  B ADDR   00B0H.7 A      268# 361 372 394 404
RS0. . . . . . . .  B ADDR   00D0H.3 A      220#
RS1. . . . . . . .  B ADDR   00D0H.4 A      219#
RSTSRC . . . . . .  D ADDR   00EFH   A      133#
RW . . . . . . . .  B ADDR   00B0H.6 A      269# 362 365 373
RXOVRN . . . . . .  B ADDR   00F8H.4 A      249#
S0MODE . . . . . .  B ADDR   0098H.7 A      166#
SBCON1 . . . . . .  D ADDR   00ACH   A      70#
SBRLH1 . . . . . .  D ADDR   00B5H   A      78#
SBRLL1 . . . . . .  D ADDR   00B4H   A      77#
SBUF0. . . . . . .  D ADDR   0099H   A      52#
SBUF1. . . . . . .  D ADDR   00D3H   A      105#
SCON0. . . . . . .  D ADDR   0098H   A      51# 166 168 169 170 171 172 173
SCON1. . . . . . .  D ADDR   00D2H   A      104#
SI . . . . . . . .  B ADDR   00C0H.0 A      203#
SMB0CF . . . . . .  D ADDR   00C1H   A      89#
SMB0CN . . . . . .  D ADDR   00C0H   A      88# 196 197 198 199 200 201 202 203
SMB0DAT. . . . . .  D ADDR   00C2H   A      90#
SMOD1. . . . . . .  D ADDR   00E5H   A      123#
SP . . . . . . . .  D ADDR   0081H   A      28#
SPI0CFG. . . . . .  D ADDR   00A1H   A      60#
SPI0CKR. . . . . .  D ADDR   00A2H   A      61#
SPI0CN . . . . . .  D ADDR   00F8H   A      142# 246 247 248 249 250 251 252 253
SPI0DAT. . . . . .  D ADDR   00A3H   A      62#
SPIEN. . . . . . .  B ADDR   00F8H.0 A      253#
SPIF . . . . . . .  B ADDR   00F8H.7 A      246#
STA. . . . . . . .  B ADDR   00C0H.5 A      198#
STO. . . . . . . .  B ADDR   00C0H.4 A      199#
T2CE . . . . . . .  B ADDR   00C8H.4 A      209#
T2CSS. . . . . . .  B ADDR   00C8H.1 A      212#
T2SPLIT. . . . . .  B ADDR   00C8H.3 A      210#
T2XCLK . . . . . .  B ADDR   00C8H.0 A      213#
TB80 . . . . . . .  B ADDR   0098H.3 A      170#
TCON . . . . . . .  D ADDR   0088H   A      35# 156 157 158 159 160 161 162 163
TF0. . . . . . . .  B ADDR   0088H.5 A      158#
TF1. . . . . . . .  B ADDR   0088H.7 A      156#
TF2H . . . . . . .  B ADDR   00C8H.7 A      206#
TF2L . . . . . . .  B ADDR   00C8H.6 A      207#
TF2LEN . . . . . .  B ADDR   00C8H.5 A      208#
TH0. . . . . . . .  D ADDR   008CH   A      39#
TH1. . . . . . . .  D ADDR   008DH   A      40#
TI0. . . . . . . .  B ADDR   0098H.1 A      172#
A51 MACRO ASSEMBLER  DISPLAY                                                              08/30/2007 21:25:42 PAGE    11

TL0. . . . . . . .  D ADDR   008AH   A      37#
TL1. . . . . . . .  D ADDR   008BH   A      38#
TMOD . . . . . . .  D ADDR   0089H   A      36#
TMR2CN . . . . . .  D ADDR   00C8H   A      96# 206 207 208 209 210 211 212 213
TMR2H. . . . . . .  D ADDR   00CDH   A      101#
TMR2L. . . . . . .  D ADDR   00CCH   A      100#
TMR2RLH. . . . . .  D ADDR   00CBH   A      99#
TMR2RLL. . . . . .  D ADDR   00CAH   A      98#
TMR3CN . . . . . .  D ADDR   0091H   A      44#
TMR3H. . . . . . .  D ADDR   0095H   A      48#
TMR3L. . . . . . .  D ADDR   0094H   A      47#
TMR3RLH. . . . . .  D ADDR   0093H   A      46#
TMR3RLL. . . . . .  D ADDR   0092H   A      45#
TR0. . . . . . . .  B ADDR   0088H.4 A      159#
TR1. . . . . . . .  B ADDR   0088H.6 A      157#
TR2. . . . . . . .  B ADDR   00C8H.2 A      211#
TXBMT. . . . . . .  B ADDR   00F8H.1 A      252#
TXMODE . . . . . .  B ADDR   00C0H.6 A      197#
USB0ADR. . . . . .  D ADDR   0096H   A      49#
USB0DAT. . . . . .  D ADDR   0097H   A      50#
USB0XCN. . . . . .  D ADDR   00D7H   A      109#
VDM0CN . . . . . .  D ADDR   00FFH   A      149#
WAIT_LCD . . . . .  C ADDR   015FH   A      360# 364 378 381 384 387 397 406
WCOL . . . . . . .  B ADDR   00F8H.6 A      247#
WRITE_2_NIBBLES. .  C ADDR   0143H   A      341# 380 383 386 396 405
WRITE_TEXT . . . .  C ADDR   01A0H   A      403# 419 421 423 425 427 429 431 433 435 437 439
XBR0 . . . . . . .  D ADDR   00E1H   A      119# 298
XBR1 . . . . . . .  D ADDR   00E2H   A      120# 286 299
XBR2 . . . . . . .  D ADDR   00E3H   A      121#


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
