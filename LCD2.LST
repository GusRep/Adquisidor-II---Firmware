A51 MACRO ASSEMBLER  LCD2                                                                 08/06/2007 22:47:11 PAGE     1


MACRO ASSEMBLER A51 V7.04a
OBJECT MODULE PLACED IN LCD2.OBJ
ASSEMBLER INVOKED BY: C:\SiLabs\MCU\IDEfiles\C51\BIN\a51.exe LCD2.asm XR GEN DB EP NOMOD51

LOC  OBJ            LINE     SOURCE

                       1     ;------------------------------------
                       2     ;-  Generated Initialization File  --
                       3     ;------------------------------------
                       4     
                       5     ;$include (C8051F340.inc)
                +1     6     ;------------------------------------------------------------------------------
                +1     7     ; C8051F340.INC
                +1     8     ;------------------------------------------------------------------------------
                +1     9     ; Copyright 2005 Silicon Laboratories, Inc.
                +1    10     ; http://www.silabs.com
                +1    11     ;
                +1    12     ; Program Description:
                +1    13     ;
                +1    14     ; Register/bit definitions for the C8051F34x family.
                +1    15     ;
                +1    16     ;
                +1    17     ; FID:            34X000003
                +1    18     ; Target:         C8051F340, 'F341, 'F342, 'F343, 'F344, 'F345, 'F346, 'F347
                +1    19     ; Tool chain:     Keil
                +1    20     ; Command Line:   None
                +1    21     ;
                +1    22     ; Release 1.0
                +1    23     ;    -Initial Revision (GP\PKC)
                +1    24     ;    -13 DEC 2005
                +1    25     ;
                +1    26     
                +1    27     ;------------------------------------------------------------------------------
                +1    28     ; Byte Registers
                +1    29     ;------------------------------------------------------------------------------
                +1    30     
  0080          +1    31     P0        DATA  080H                   ; Port 0 Latch
  0081          +1    32     SP        DATA  081H                   ; Stack Pointer
  0082          +1    33     DPL       DATA  082H                   ; Data Pointer Low
  0083          +1    34     DPH       DATA  083H                   ; Data Pointer High
  0084          +1    35     EMI0TC    DATA  084H                   ; External Memory Interface Timing
  0085          +1    36     EMI0CF    DATA  085H                   ; External Memory Interface Config
  0086          +1    37     OSCLCN    DATA  086H                   ; Internal Low-Freq Oscillator Control
  0087          +1    38     PCON      DATA  087H                   ; Power Control
  0088          +1    39     TCON      DATA  088H                   ; Timer/Counter Control
  0089          +1    40     TMOD      DATA  089H                   ; Timer/Counter Mode
  008A          +1    41     TL0       DATA  08AH                   ; Timer/Counter 0 Low
  008B          +1    42     TL1       DATA  08BH                   ; Timer/Counter 1 Low
  008C          +1    43     TH0       DATA  08CH                   ; Timer/Counter 0 High
  008D          +1    44     TH1       DATA  08DH                   ; Timer/Counter 1 High
  008E          +1    45     CKCON     DATA  08EH                   ; Clock Control
  008F          +1    46     PSCTL     DATA  08FH                   ; Program Store R/W Control
  0090          +1    47     P1        DATA  090H                   ; Port 1 Latch
  0091          +1    48     TMR3CN    DATA  091H                   ; Timer/Counter 3Control
  0092          +1    49     TMR3RLL   DATA  092H                   ; Timer/Counter 3 Reload Low
  0093          +1    50     TMR3RLH   DATA  093H                   ; Timer/Counter 3 Reload High
  0094          +1    51     TMR3L     DATA  094H                   ; Timer/Counter 3Low
  0095          +1    52     TMR3H     DATA  095H                   ; Timer/Counter 3 High
  0096          +1    53     USB0ADR   DATA  096H                   ; USB0 Indirect Address Register
  0097          +1    54     USB0DAT   DATA  097H                   ; USB0 Data Register
  0098          +1    55     SCON0     DATA  098H                   ; UART0 Control
  0099          +1    56     SBUF0     DATA  099H                   ; UART0 Data Buffer
  009A          +1    57     CPT1CN    DATA  09AH                   ; Comparator1 Control
  009B          +1    58     CPT0CN    DATA  09BH                   ; Comparator0 Control
A51 MACRO ASSEMBLER  LCD2                                                                 08/06/2007 22:47:11 PAGE     2

  009C          +1    59     CPT1MD    DATA  09CH                   ; Comparator1 Mode Selection
  009D          +1    60     CPT0MD    DATA  09DH                   ; Comparator0 Mode Selection
  009E          +1    61     CPT1MX    DATA  09EH                   ; Comparator1 MUX Selection
  009F          +1    62     CPT0MX    DATA  09FH                   ; Comparator0 MUX Selection
  00A0          +1    63     P2        DATA  0A0H                   ; Port 2 Latch
  00A1          +1    64     SPI0CFG   DATA  0A1H                   ; SPI Configuration
  00A2          +1    65     SPI0CKR   DATA  0A2H                   ; SPI Clock Rate Control
  00A3          +1    66     SPI0DAT   DATA  0A3H                   ; SPI Data
  00A4          +1    67     P0MDOUT   DATA  0A4H                   ; Port 0 Output Mode Configuration
  00A5          +1    68     P1MDOUT   DATA  0A5H                   ; Port 1 Output Mode Configuration
  00A6          +1    69     P2MDOUT   DATA  0A6H                   ; Port 2 Output Mode Configuration
  00A7          +1    70     P3MDOUT   DATA  0A7H                   ; Port 3 Output Mode Configuration
  00A8          +1    71     IE        DATA  0A8H                   ; Interrupt Enable
  00A9          +1    72     CLKSEL    DATA  0A9H                   ; Clock Select
  00AA          +1    73     EMI0CN    DATA  0AAH                   ; External Memory Interface Control
  00AC          +1    74     SBCON1    DATA  0ACH                   ; UART1 Baud Rate Generator Control
  00AE          +1    75     P4MDOUT   DATA  0AEH                   ; Port 4 Output Mode Configuration
  00AF          +1    76     PFE0CN    DATA  0AFH                   ; Prefetch Engine Control
  00B0          +1    77     P3        DATA  0B0H                   ; Port 3 Latch
  00B1          +1    78     OSCXCN    DATA  0B1H                   ; External Oscillator Control
  00B2          +1    79     OSCICN    DATA  0B2H                   ; Internal Oscillator Control
  00B3          +1    80     OSCICL    DATA  0B3H                   ; Internal Oscillator Calibration
  00B4          +1    81     SBRLL1    DATA  0B4H                   ; UART1 Baud Rate Generator Low
  00B5          +1    82     SBRLH1    DATA  0B5H                   ; UART1 Baud Rate Generator High
  00B6          +1    83     FLSCL     DATA  0B6H                   ; Flash Scale
  00B7          +1    84     FLKEY     DATA  0B7H                   ; Flash Lock and Key
  00B8          +1    85     IP        DATA  0B8H                   ; Interrupt Priority
  00B9          +1    86     CLKMUL    DATA  0B9H                   ; Clock Multiplier
  00BA          +1    87     AMX0N     DATA  0BAH                   ; AMUX0 Negative Channel Select
  00BB          +1    88     AMX0P     DATA  0BBH                   ; AMUX0 Positive Channel Select
  00BC          +1    89     ADC0CF    DATA  0BCH                   ; ADC0 Configuration
  00BD          +1    90     ADC0L     DATA  0BDH                   ; ADC0 Low
  00BE          +1    91     ADC0H     DATA  0BEH                   ; ADC0 High
  00C0          +1    92     SMB0CN    DATA  0C0H                   ; SMBus Control
  00C1          +1    93     SMB0CF    DATA  0C1H                   ; SMBus Configuration
  00C2          +1    94     SMB0DAT   DATA  0C2H                   ; SMBus Data
  00C3          +1    95     ADC0GTL   DATA  0C3H                   ; ADC0 Greater-Than Compare Low
  00C4          +1    96     ADC0GTH   DATA  0C4H                   ; ADC0 Greater-Than Compare High
  00C5          +1    97     ADC0LTL   DATA  0C5H                   ; ADC0 Less-Than Compare Word Low
  00C6          +1    98     ADC0LTH   DATA  0C6H                   ; ADC0 Less-Than Compare Word High
  00C7          +1    99     P4        DATA  0C7H                   ; Port 4 Latch
  00C8          +1   100     TMR2CN    DATA  0C8H                   ; Timer/Counter 2 Control
  00C9          +1   101     REG0CN    DATA  0C9H                   ; Voltage Regulator Control
  00CA          +1   102     TMR2RLL   DATA  0CAH                   ; Timer/Counter 2 Reload Low
  00CB          +1   103     TMR2RLH   DATA  0CBH                   ; Timer/Counter 2 Reload High
  00CC          +1   104     TMR2L     DATA  0CCH                   ; Timer/Counter 2 Low
  00CD          +1   105     TMR2H     DATA  0CDH                   ; Timer/Counter 2 High
  00D0          +1   106     PSW       DATA  0D0H                   ; Program Status Word
  00D1          +1   107     REF0CN    DATA  0D1H                   ; Voltage Reference Control
  00D2          +1   108     SCON1     DATA  0D2H                   ; UART1 Control
  00D3          +1   109     SBUF1     DATA  0D3H                   ; UART1 Data Buffer
  00D4          +1   110     P0SKIP    DATA  0D4H                   ; Port 0 Skip
  00D5          +1   111     P1SKIP    DATA  0D5H                   ; Port 1 Skip
  00D6          +1   112     P2SKIP    DATA  0D6H                   ; Port 2 Skip
  00D7          +1   113     USB0XCN   DATA  0D7H                   ; USB0 Transceiver Control
  00D8          +1   114     PCA0CN    DATA  0D8H                   ; PCA Control
  00D9          +1   115     PCA0MD    DATA  0D9H                   ; PCA Mode
  00DA          +1   116     PCA0CPM0  DATA  0DAH                   ; PCA Module 0 Mode Register
  00DB          +1   117     PCA0CPM1  DATA  0DBH                   ; PCA Module 1 Mode Register
  00DC          +1   118     PCA0CPM2  DATA  0DCH                   ; PCA Module 2 Mode Register
  00DD          +1   119     PCA0CPM3  DATA  0DDH                   ; PCA Module 3 Mode Register
  00DE          +1   120     PCA0CPM4  DATA  0DEH                   ; PCA Module 4 Mode Register
  00DF          +1   121     P3SKIP    DATA  0DFH                   ; Port 3Skip
  00E0          +1   122     ACC       DATA  0E0H                   ; Accumulator
  00E1          +1   123     XBR0      DATA  0E1H                   ; Port I/O Crossbar Control 0
  00E2          +1   124     XBR1      DATA  0E2H                   ; Port I/O Crossbar Control 1
A51 MACRO ASSEMBLER  LCD2                                                                 08/06/2007 22:47:11 PAGE     3

  00E3          +1   125     XBR2      DATA  0E3H                   ; Port I/O Crossbar Control 2
  00E4          +1   126     IT01CF    DATA  0E4H                   ; INT0/INT1 Configuration
  00E5          +1   127     SMOD1     DATA  0E5H                   ; UART1 Mode
  00E6          +1   128     EIE1      DATA  0E6H                   ; Extended Interrupt Enable 1
  00E7          +1   129     EIE2      DATA  0E7H                   ; Extended Interrupt Enable 2
  00E8          +1   130     ADC0CN    DATA  0E8H                   ; ADC0 Control
  00E9          +1   131     PCA0CPL1  DATA  0E9H                   ; PCA Capture 1 Low
  00EA          +1   132     PCA0CPH1  DATA  0EAH                   ; PCA Capture 1 High
  00EB          +1   133     PCA0CPL2  DATA  0EBH                   ; PCA Capture 2 Low
  00EC          +1   134     PCA0CPH2  DATA  0ECH                   ; PCA Capture 2 High
  00ED          +1   135     PCA0CPL3  DATA  0EDH                   ; PCA Capture 3 Low
  00EE          +1   136     PCA0CPH3  DATA  0EEH                   ; PCA Capture 3High
  00EF          +1   137     RSTSRC    DATA  0EFH                   ; Reset Source Configuration/Status
  00F0          +1   138     B         DATA  0F0H                   ; B Register
  00F1          +1   139     P0MDIN    DATA  0F1H                   ; Port 0 Input Mode Configuration
  00F2          +1   140     P1MDIN    DATA  0F2H                   ; Port 1 Input Mode Configuration
  00F3          +1   141     P2MDIN    DATA  0F3H                   ; Port 2 Input Mode Configuration
  00F4          +1   142     P3MDIN    DATA  0F4H                   ; Port 3 Input Mode Configuration
  00F5          +1   143     P4MDIN    DATA  0F5H                   ; Port 4 Input Mode Configuration
  00F6          +1   144     EIP1      DATA  0F6H                   ; Extended Interrupt Priority 1
  00F7          +1   145     EIP2      DATA  0F7H                   ; Extended Interrupt Priority 2
  00F8          +1   146     SPI0CN    DATA  0F8H                   ; SPI Control
  00F9          +1   147     PCA0L     DATA  0F9H                   ; PCA Counter Low
  00FA          +1   148     PCA0H     DATA  0FAH                   ; PCA Counter High
  00FB          +1   149     PCA0CPL0  DATA  0FBH                   ; PCA Capture 0 Low
  00FC          +1   150     PCA0CPH0  DATA  0FCH                   ; PCA Capture 0 High
  00FD          +1   151     PCA0CPL4  DATA  0FDH                   ; PCA Capture 4 Low
  00FE          +1   152     PCA0CPH4  DATA  0FEH                   ; PCA Capture 4 High
  00FF          +1   153     VDM0CN    DATA  0FFH                   ; VDD Monitor Control
                +1   154     
                +1   155     ;------------------------------------------------------------------------------
                +1   156     ; Bit Definitions
                +1   157     ;------------------------------------------------------------------------------
                +1   158     
                +1   159     ; TCON  088H
  008F          +1   160     TF1     BIT     TCON.7                 ; Timer1 overflow flag
  008E          +1   161     TR1     BIT     TCON.6                 ; Timer1 on/off control
  008D          +1   162     TF0     BIT     TCON.5                 ; Timer0 overflow flag
  008C          +1   163     TR0     BIT     TCON.4                 ; Timer0 on/off control
  008B          +1   164     IE1     BIT     TCON.3                 ; Ext. Interrupt 1 edge flag
  008A          +1   165     IT1     BIT     TCON.2                 ; Ext. Interrupt 1 type
  0089          +1   166     IE0     BIT     TCON.1                 ; Ext. Interrupt 0 edge flag
  0088          +1   167     IT0     BIT     TCON.0                 ; Ext. Interrupt 0 type
                +1   168     
                +1   169     ; SCON0  098H
  009F          +1   170     S0MODE  BIT     SCON0.7                ; Serial mode control bit 0
                +1   171                                            ; Bit 6 unused
  009D          +1   172     MCE0    BIT     SCON0.5                ; Multiprocessor communication enable
  009C          +1   173     REN0    BIT     SCON0.4                ; Receive enable
  009B          +1   174     TB80    BIT     SCON0.3                ; Transmit bit 8
  009A          +1   175     RB80    BIT     SCON0.2                ; Receive bit 8
  0099          +1   176     TI0     BIT     SCON0.1                ; Transmit interrupt flag
  0098          +1   177     RI0     BIT     SCON0.0                ; Receive interrupt flag
                +1   178     
                +1   179     ; IE  0A8H
  00AF          +1   180     EA      BIT     IE.7                   ; Global interrupt enable
  00AE          +1   181     ESPI0   BIT     IE.6                   ; Bit 6 unused
  00AD          +1   182     ET2     BIT     IE.5                   ; Bit 5 unused
  00AC          +1   183     ES0     BIT     IE.4                   ; UART0 interrupt enable
  00AB          +1   184     ET1     BIT     IE.3                   ; Timer1 interrupt enable
  00AA          +1   185     EX1     BIT     IE.2                   ; External interrupt 1 enable
  00A9          +1   186     ET0     BIT     IE.1                   ; Timer0 interrupt enable
  00A8          +1   187     EX0     BIT     IE.0                   ; External interrupt 0 enable
                +1   188     
                +1   189     ; IP  0B8H
                +1   190                                            ; Bit 7 unused
A51 MACRO ASSEMBLER  LCD2                                                                 08/06/2007 22:47:11 PAGE     4

  00BE          +1   191     PSPI0   BIT     IP.6                   ; SPI0 interrupt priority
  00BD          +1   192     PT2     BIT     IP.5                   ; Timer2 priority
  00BC          +1   193     PS0     BIT     IP.4                   ; UART0 priority
  00BB          +1   194     PT1     BIT     IP.3                   ; Timer1 priority
  00BA          +1   195     PX1     BIT     IP.2                   ; External interrupt 1 priority
  00B9          +1   196     PT0     BIT     IP.1                   ; Timer0 priority
  00B8          +1   197     PX0     BIT     IP.0                   ; External interrupt 0 priority
                +1   198     
                +1   199     ; SMB0CN  0C0H
  00C7          +1   200     MASTER  BIT     SMB0CN.7               ; Master/slave indicator
  00C6          +1   201     TXMODE  BIT     SMB0CN.6               ; Transmit mode indicator
  00C5          +1   202     STA     BIT     SMB0CN.5               ; Start flag
  00C4          +1   203     STO     BIT     SMB0CN.4               ; Stop flag
  00C3          +1   204     ACKRQ   BIT     SMB0CN.3               ; Acknowledge request
  00C2          +1   205     ARBLOST BIT     SMB0CN.2               ; Arbitration lost indicator
  00C1          +1   206     ACK     BIT     SMB0CN.1               ; Acknowledge flag
  00C0          +1   207     SI      BIT     SMB0CN.0               ; SMBus interrupt flag
                +1   208     
                +1   209     ; TMR2CN  0C8H
  00CF          +1   210     TF2H    BIT     TMR2CN.7               ; Timer2 high byte overflow flag
  00CE          +1   211     TF2L    BIT     TMR2CN.6               ; Timer2 low byte overflow flag
  00CD          +1   212     TF2LEN  BIT     TMR2CN.5               ; Timer2 low byte interrupt enable
  00CC          +1   213     T2CE    BIT     TMR2CN.4               ; Timer2 capture enable
  00CB          +1   214     T2SPLIT BIT     TMR2CN.3               ; Timer2 split mode enable
  00CA          +1   215     TR2     BIT     TMR2CN.2               ; Timer2 on/off control
  00C9          +1   216     T2CSS   BIT     TMR2CN.1               ; Timer 2 Capture Source select
  00C8          +1   217     T2XCLK  BIT     TMR2CN.0               ; Timer2 external clock select
                +1   218     
                +1   219     ; PSW  0D0H
  00D7          +1   220     CY      BIT     PSW.7                  ; Carry flag
  00D6          +1   221     AC      BIT     PSW.6                  ; Auxiliary carry flag
  00D5          +1   222     F0      BIT     PSW.5                  ; User flag 0
  00D4          +1   223     RS1     BIT     PSW.4                  ; Register bank select 1
  00D3          +1   224     RS0     BIT     PSW.3                  ; Register bank select 0
  00D2          +1   225     OV      BIT     PSW.2                  ; Overflow flag
  00D1          +1   226     F1      BIT     PSW.1                  ; User flag 1
  00D0          +1   227     P       BIT     PSW.0                  ; Accumulator parity flag
                +1   228     
                +1   229     ; PCA0CN  0D8H
  00DF          +1   230     CF      BIT     PCA0CN.7               ; PCA0 counter overflow flag
  00DE          +1   231     CR      BIT     PCA0CN.6               ; PCA0 counter run control
                +1   232                                            ; Bit5 UNUSED
  00DC          +1   233     CCF4    BIT     PCA0CN.4               ; PCA0 module4 capture/compare flag
  00DB          +1   234     CCF3    BIT     PCA0CN.3               ; PCA0 module3 capture/compare flag
  00DA          +1   235     CCF2    BIT     PCA0CN.2               ; PCA0 module2 capture/compare flag
  00D9          +1   236     CCF1    BIT     PCA0CN.1               ; PCA0 module1 capture/compare flag
  00D8          +1   237     CCF0    BIT     PCA0CN.0               ; PCA0 module0 capture/compare flag
                +1   238     
                +1   239     ; ADC0CN  0E8H
  00EF          +1   240     AD0EN   BIT     ADC0CN.7               ; ADC0 enable
  00EE          +1   241     AD0TM   BIT     ADC0CN.6               ; ADC0 track mode
  00ED          +1   242     AD0INT  BIT     ADC0CN.5               ; ADC0 converision complete interrupt flag
  00EC          +1   243     AD0BUSY BIT     ADC0CN.4               ; ADC0 busy flag
  00EB          +1   244     AD0WINT BIT     ADC0CN.3               ; ADC0 window compare interrupt flag
  00EA          +1   245     AD0CM2  BIT     ADC0CN.2               ; ADC0 conversion mode select 2
  00E9          +1   246     AD0CM1  BIT     ADC0CN.1               ; ADC0 conversion mode select 1
  00E8          +1   247     AD0CM0  BIT     ADC0CN.0               ; ADC0 conversion mode select 0
                +1   248     
                +1   249     ; SPI0CN  0F8H
  00FF          +1   250     SPIF    BIT     SPI0CN.7               ; SPI0 interrupt flag
  00FE          +1   251     WCOL    BIT     SPI0CN.6               ; SPI0 write collision flag
  00FD          +1   252     MODF    BIT     SPI0CN.5               ; SPI0 mode fault flag
  00FC          +1   253     RXOVRN  BIT     SPI0CN.4               ; SPI0 rx overrun flag
  00FB          +1   254     NSSMD1  BIT     SPI0CN.3               ; SPI0 slave select mode 1
  00FA          +1   255     NSSMD0  BIT     SPI0CN.2               ; SPI0 slave select mode 0
  00F9          +1   256     TXBMT   BIT     SPI0CN.1               ; SPI0 transmit buffer empty
A51 MACRO ASSEMBLER  LCD2                                                                 08/06/2007 22:47:11 PAGE     5

  00F8          +1   257     SPIEN   BIT     SPI0CN.0               ; SPI0 SPI enable
                +1   258     
                +1   259     ;------------------------------------------------------------------------------
                +1   260     ; End Of File
                +1   261     ;------------------------------------------------------------------------------
                     262     
                     263     
                     264     
                     265     ;-----------------------LCD 4-bit--------------------------
                     266     ;LCD Connections to microcontroller
  00B5               267     E               EQU     P3.5            ; PIN 6 enable
  00B7               268     RS              EQU     P3.7    ; /register select
                     269     
  0090               270     DATOS           EQU     P1              ; DATOS lines P0-P3
                     271     ;----------------------------------------------------------
0000                 272     org     000h
                     273     
0000 2100            274             ajmp on_reset
                     275     ;----------------------------------------------------------
0100                 276     org     100h
0100                 277     on_reset:       
                     278     
                     279     ;---------------SETEOS-------------------------  
0100 75A408          280         mov  P0MDOUT,   #008h
0103 75A50F          281         mov  P1MDOUT,   #00Fh
0106 75A7F0          282         mov  P3MDOUT,   #0F0h
0109 75E102          283         mov  XBR0,      #002h
010C 75E240          284         mov  XBR1,      #040h
                     285     
                     286     
010F                 287     Oscillator_Init:
010F 75B283          288         mov  OSCICN,    #083h
                     289     
0112                 290     PCA_Init:
0112 53D9BF          291         anl  PCA0MD,    #0BFh
0115 75D900          292         mov  PCA0MD,    #000h
                     293     
                     294     ;-----------FIN SETEOS------------------------- 
                     295     
                     296     
                     297     
                     298     
0118 900200          299                     MOV DPTR,#init_DATOS
011B 3161            300                     acall disp_init
                     301                     
011D 9001E0          302                     MOV DPTR,#message1
0120 3152            303                     acall disp_string
                     304                     
0122 31AE            305                     acall disp_line2
                     306                     
0124 9001F0          307                     MOV DPTR,#message2
0127 3152            308                     acall disp_string
                     309     
0129                 310     ENDLESS:
0129 2129            311                     ajmp ENDLESS    
                     312     ;----------------------------------------------------------
                     313     ; display char in A
                     314     ; used reg R2
012B                 315     disp_char:
012B D2B7            316                     SETB RS                 ; desable register select
                     317                     
012D FA              318                     MOV R2,A
012E 54F0            319                     ANL A,#0F0H                     ; send high nybble first
0130 03              320                     RR A
0131 03              321                     RR A
0132 03              322                     RR A
A51 MACRO ASSEMBLER  LCD2                                                                 08/06/2007 22:47:11 PAGE     6

0133 03              323                     RR A
0134 5390F0          324                     ANL DATOS,#0F0H
0137 4290            325                     ORL DATOS,A
                     326                     
0139 D2B5            327                     SETB E                  ; give E pulse
013B 31CD            328                     acall delay_DATOS
013D C2B5            329                     CLR E
013F 31CD            330                     acall delay_DATOS
                     331                     
0141 EA              332                     MOV A,R2
0142 540F            333                     ANL A,#0FH                      ; send lower nybble
0144 5390F0          334                     ANL DATOS,#0F0H
0147 4290            335                     ORL DATOS,A
                     336                     
0149 D2B5            337                     SETB E                  ; give E pulse
014B 31CD            338                     acall delay_DATOS
014D C2B5            339                     CLR E
014F 31CD            340                     acall delay_DATOS
                     341                     
                     342                     
0151 22              343     RET
                     344     ;----------------------------------------------------------
                     345     ; used registers A,R1,R7
0152                 346     disp_string:
0152 7400            347                     MOV A,#00H
0154 7900            348                     MOV R1,#00h
0156                 349     next_char:
0156 09              350                     INC R1                  
0157 93              351                     MOVC A,@A+DPTR
0158 F590            352                             MOV DATOS,A
015A 312B            353                             acall disp_char
015C E8              354                             MOV A,R0
015D B90FF6          355                     CJNE R1,#0Fh,next_char                  
0160 22              356     RET
                     357     ;----------------------------------------------------------
                     358     ; used registers A,R1,R7,R2
0161                 359     disp_init:
0161 C2B7            360                     CLR RS                  ; enable /register select
0163 7400            361                     MOV A,#00H
0165 7900            362                     MOV R1,#00h
0167                 363     next_chari:
0167 09              364                     INC R1                  
0168 93              365                     MOVC A,@A+DPTR
0169 FA              366                     MOV R2,A                        ; take backup
                     367                     
016A 54F0            368                     ANL A,#0F0H                     ; send high nybble first
016C 03              369                     RR A
016D 03              370                     RR A
016E 03              371                     RR A
016F 03              372                     RR A
0170 5390F0          373                     ANL DATOS,#0F0H
0173 4290            374                     ORL DATOS,A
                     375                     
0175 D2B5            376                     SETB E                  ; give E pulse
0177 31D4            377                     acall delay_init
0179 C2B5            378                     CLR E
017B 31D4            379                     acall delay_init
                     380                     
017D EA              381                     MOV A,R2
017E 540F            382                     ANL A,#0FH                      ; send lower nybble
0180 5390F0          383                     ANL DATOS,#0F0H
0183 4290            384                     ORL DATOS,A
                     385                     
0185 D2B5            386                     SETB E                  ; give E pulse
0187 31D4            387                     acall delay_init
0189 C2B5            388                     CLR E
A51 MACRO ASSEMBLER  LCD2                                                                 08/06/2007 22:47:11 PAGE     7

018B 31D4            389                     acall delay_init
                     390     
018D E8              391                     MOV A,R0
018E B902D6          392                     CJNE R1,#02h,next_chari 
                     393                     
                     394     
0191 22              395     RET
                     396     ;----------------------------------------------------------
0192                 397     disp_line1:
0192 C2B7            398                     CLR RS                  ; register select
0194 5390F0          399                     ANL DATOS,#0F0H
0197 439008          400                     ORL DATOS,#08H          ; first line address
019A D2B5            401                     SETB E                  ; give E pulse
019C 31D4            402                     acall delay_init
019E C2B5            403                     CLR E
01A0 31D4            404                     acall delay_init
                     405                     
01A2 5390F0          406                     ANL DATOS,#0F0H         ; second nybble
01A5 D2B5            407                     SETB E                  ; give E pulse
01A7 31D4            408                     acall delay_init
01A9 C2B5            409                     CLR E
01AB 31D4            410                     acall delay_init
                     411     
01AD 22              412     RET
                     413     ;----------------------------------------------------------
01AE                 414     disp_line2:
01AE C2B7            415                     CLR RS                  ; register select       
01B0 5390F0          416                     ANL DATOS,#0F0H         ; next line address
01B3 43900A          417                     ORL DATOS,#0AH
01B6 D2B5            418                     SETB E                  ; give E pulse
01B8 31D4            419                     acall delay_init
01BA C2B5            420                     CLR E
01BC 31D4            421                     acall delay_init
                     422                     
01BE 5390F0          423                     ANL DATOS,#0F0H         ; next line address
01C1 439008          424                     ORL DATOS,#08H
01C4 D2B5            425                     SETB E                  ; give E pulse
01C6 31D4            426                     acall delay_init
01C8 C2B5            427                     CLR E
01CA 31D4            428                     acall delay_init
                     429     
01CC 22              430     RET
                     431     ;----------------------------------------------------------
                     432     ;2 msec delay
01CD                 433     delay_DATOS:
01CD 7FFF            434                     MOV R7,#0FFH
01CF 00              435     del:            NOP
01D0 00              436                     NOP
01D1 DFFC            437                     DJNZ R7, del    
01D3 22              438     RET
                     439     ;----------------------------------------------------------
                     440     ;20 msec delay
01D4                 441     delay_init:
01D4 7FFF            442                     MOV R7,#0FFH
01D6 00              443     del1:           NOP
01D7 00              444                     NOP
01D8 00              445                     NOP
01D9 00              446                     NOP
01DA 00              447                     NOP
01DB 00              448                     NOP
01DC 00              449                     NOP
01DD DFF7            450                     DJNZ R7, del1   
                     451     
01DF 22              452     RET
                     453     ;----------------------------------------------------------
01E0                 454     message1:
A51 MACRO ASSEMBLER  LCD2                                                                 08/06/2007 22:47:11 PAGE     8

01E0 54657374        455     DB "Testing 123.... "
01E4 696E6720                
01E8 3132332E                
01EC 2E2E2E20                
01F0                 456     message2:
01F0 49742773        457     DB "It's working    "
01F4 20776F72                
01F8 6B696E67                
01FC 20202020                
0200                 458     init_DATOS:
0200 0F              459     DB 0FH ; Display On, Cursor On,Cursor Blink On(1)/Off(0)
0201 01              460     DB 01H ; Clear Display
0202 38              461     DB 38H ; Set Interface Length
                     462     
                     463     
                     464     end
                             
A51 MACRO ASSEMBLER  LCD2                                                                 08/06/2007 22:47:11 PAGE     9

XREF SYMBOL TABLE LISTING
---- ------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES / REFERENCES

AC . . . . . . . .  B ADDR   00D0H.6 A      221#
ACC. . . . . . . .  D ADDR   00E0H   A      122#
ACK. . . . . . . .  B ADDR   00C0H.1 A      206#
ACKRQ. . . . . . .  B ADDR   00C0H.3 A      204#
AD0BUSY. . . . . .  B ADDR   00E8H.4 A      243#
AD0CM0 . . . . . .  B ADDR   00E8H.0 A      247#
AD0CM1 . . . . . .  B ADDR   00E8H.1 A      246#
AD0CM2 . . . . . .  B ADDR   00E8H.2 A      245#
AD0EN. . . . . . .  B ADDR   00E8H.7 A      240#
AD0INT . . . . . .  B ADDR   00E8H.5 A      242#
AD0TM. . . . . . .  B ADDR   00E8H.6 A      241#
AD0WINT. . . . . .  B ADDR   00E8H.3 A      244#
ADC0CF . . . . . .  D ADDR   00BCH   A      89#
ADC0CN . . . . . .  D ADDR   00E8H   A      130# 240 241 242 243 244 245 246 247
ADC0GTH. . . . . .  D ADDR   00C4H   A      96#
ADC0GTL. . . . . .  D ADDR   00C3H   A      95#
ADC0H. . . . . . .  D ADDR   00BEH   A      91#
ADC0L. . . . . . .  D ADDR   00BDH   A      90#
ADC0LTH. . . . . .  D ADDR   00C6H   A      98#
ADC0LTL. . . . . .  D ADDR   00C5H   A      97#
AMX0N. . . . . . .  D ADDR   00BAH   A      87#
AMX0P. . . . . . .  D ADDR   00BBH   A      88#
ARBLOST. . . . . .  B ADDR   00C0H.2 A      205#
B. . . . . . . . .  D ADDR   00F0H   A      138#
CCF0 . . . . . . .  B ADDR   00D8H.0 A      237#
CCF1 . . . . . . .  B ADDR   00D8H.1 A      236#
CCF2 . . . . . . .  B ADDR   00D8H.2 A      235#
CCF3 . . . . . . .  B ADDR   00D8H.3 A      234#
CCF4 . . . . . . .  B ADDR   00D8H.4 A      233#
CF . . . . . . . .  B ADDR   00D8H.7 A      230#
CKCON. . . . . . .  D ADDR   008EH   A      45#
CLKMUL . . . . . .  D ADDR   00B9H   A      86#
CLKSEL . . . . . .  D ADDR   00A9H   A      72#
CPT0CN . . . . . .  D ADDR   009BH   A      58#
CPT0MD . . . . . .  D ADDR   009DH   A      60#
CPT0MX . . . . . .  D ADDR   009FH   A      62#
CPT1CN . . . . . .  D ADDR   009AH   A      57#
CPT1MD . . . . . .  D ADDR   009CH   A      59#
CPT1MX . . . . . .  D ADDR   009EH   A      61#
CR . . . . . . . .  B ADDR   00D8H.6 A      231#
CY . . . . . . . .  B ADDR   00D0H.7 A      220#
DATOS. . . . . . .  D ADDR   0090H   A      270# 324 325 334 335 352 373 374 383 384 399 400 406 416 417 423 424
DEL. . . . . . . .  C ADDR   01CFH   A      435# 437
DEL1 . . . . . . .  C ADDR   01D6H   A      443# 450
DELAY_DATOS. . . .  C ADDR   01CDH   A      328 330 338 340 433#
DELAY_INIT . . . .  C ADDR   01D4H   A      377 379 387 389 402 404 408 410 419 421 426 428 441#
DISP_CHAR. . . . .  C ADDR   012BH   A      315# 353
DISP_INIT. . . . .  C ADDR   0161H   A      300 359#
DISP_LINE1 . . . .  C ADDR   0192H   A      397#
DISP_LINE2 . . . .  C ADDR   01AEH   A      305 414#
DISP_STRING. . . .  C ADDR   0152H   A      303 308 346#
DPH. . . . . . . .  D ADDR   0083H   A      34#
DPL. . . . . . . .  D ADDR   0082H   A      33#
E. . . . . . . . .  B ADDR   00B0H.5 A      267# 327 329 337 339 376 378 386 388 401 403 407 409 418 420 425 427
EA . . . . . . . .  B ADDR   00A8H.7 A      180#
EIE1 . . . . . . .  D ADDR   00E6H   A      128#
EIE2 . . . . . . .  D ADDR   00E7H   A      129#
EIP1 . . . . . . .  D ADDR   00F6H   A      144#
EIP2 . . . . . . .  D ADDR   00F7H   A      145#
EMI0CF . . . . . .  D ADDR   0085H   A      36#
A51 MACRO ASSEMBLER  LCD2                                                                 08/06/2007 22:47:11 PAGE    10

EMI0CN . . . . . .  D ADDR   00AAH   A      73#
EMI0TC . . . . . .  D ADDR   0084H   A      35#
ENDLESS. . . . . .  C ADDR   0129H   A      310# 311
ES0. . . . . . . .  B ADDR   00A8H.4 A      183#
ESPI0. . . . . . .  B ADDR   00A8H.6 A      181#
ET0. . . . . . . .  B ADDR   00A8H.1 A      186#
ET1. . . . . . . .  B ADDR   00A8H.3 A      184#
ET2. . . . . . . .  B ADDR   00A8H.5 A      182#
EX0. . . . . . . .  B ADDR   00A8H.0 A      187#
EX1. . . . . . . .  B ADDR   00A8H.2 A      185#
F0 . . . . . . . .  B ADDR   00D0H.5 A      222#
F1 . . . . . . . .  B ADDR   00D0H.1 A      226#
FLKEY. . . . . . .  D ADDR   00B7H   A      84#
FLSCL. . . . . . .  D ADDR   00B6H   A      83#
IE . . . . . . . .  D ADDR   00A8H   A      71# 180 181 182 183 184 185 186 187
IE0. . . . . . . .  B ADDR   0088H.1 A      166#
IE1. . . . . . . .  B ADDR   0088H.3 A      164#
INIT_DATOS . . . .  C ADDR   0200H   A      299 458#
IP . . . . . . . .  D ADDR   00B8H   A      85# 191 192 193 194 195 196 197
IT0. . . . . . . .  B ADDR   0088H.0 A      167#
IT01CF . . . . . .  D ADDR   00E4H   A      126#
IT1. . . . . . . .  B ADDR   0088H.2 A      165#
MASTER . . . . . .  B ADDR   00C0H.7 A      200#
MCE0 . . . . . . .  B ADDR   0098H.5 A      172#
MESSAGE1 . . . . .  C ADDR   01E0H   A      302 454#
MESSAGE2 . . . . .  C ADDR   01F0H   A      307 456#
MODF . . . . . . .  B ADDR   00F8H.5 A      252#
NEXT_CHAR. . . . .  C ADDR   0156H   A      349# 355
NEXT_CHARI . . . .  C ADDR   0167H   A      363# 392
NSSMD0 . . . . . .  B ADDR   00F8H.2 A      255#
NSSMD1 . . . . . .  B ADDR   00F8H.3 A      254#
ON_RESET . . . . .  C ADDR   0100H   A      274 277#
OSCICL . . . . . .  D ADDR   00B3H   A      80#
OSCICN . . . . . .  D ADDR   00B2H   A      79# 288
OSCILLATOR_INIT. .  C ADDR   010FH   A      287#
OSCLCN . . . . . .  D ADDR   0086H   A      37#
OSCXCN . . . . . .  D ADDR   00B1H   A      78#
OV . . . . . . . .  B ADDR   00D0H.2 A      225#
P. . . . . . . . .  B ADDR   00D0H.0 A      227#
P0 . . . . . . . .  D ADDR   0080H   A      31#
P0MDIN . . . . . .  D ADDR   00F1H   A      139#
P0MDOUT. . . . . .  D ADDR   00A4H   A      67# 280
P0SKIP . . . . . .  D ADDR   00D4H   A      110#
P1 . . . . . . . .  D ADDR   0090H   A      47# 270
P1MDIN . . . . . .  D ADDR   00F2H   A      140#
P1MDOUT. . . . . .  D ADDR   00A5H   A      68# 281
P1SKIP . . . . . .  D ADDR   00D5H   A      111#
P2 . . . . . . . .  D ADDR   00A0H   A      63#
P2MDIN . . . . . .  D ADDR   00F3H   A      141#
P2MDOUT. . . . . .  D ADDR   00A6H   A      69#
P2SKIP . . . . . .  D ADDR   00D6H   A      112#
P3 . . . . . . . .  D ADDR   00B0H   A      77# 267 268
P3MDIN . . . . . .  D ADDR   00F4H   A      142#
P3MDOUT. . . . . .  D ADDR   00A7H   A      70# 282
P3SKIP . . . . . .  D ADDR   00DFH   A      121#
P4 . . . . . . . .  D ADDR   00C7H   A      99#
P4MDIN . . . . . .  D ADDR   00F5H   A      143#
P4MDOUT. . . . . .  D ADDR   00AEH   A      75#
PCA0CN . . . . . .  D ADDR   00D8H   A      114# 230 231 233 234 235 236 237
PCA0CPH0 . . . . .  D ADDR   00FCH   A      150#
PCA0CPH1 . . . . .  D ADDR   00EAH   A      132#
PCA0CPH2 . . . . .  D ADDR   00ECH   A      134#
PCA0CPH3 . . . . .  D ADDR   00EEH   A      136#
PCA0CPH4 . . . . .  D ADDR   00FEH   A      152#
PCA0CPL0 . . . . .  D ADDR   00FBH   A      149#
PCA0CPL1 . . . . .  D ADDR   00E9H   A      131#
A51 MACRO ASSEMBLER  LCD2                                                                 08/06/2007 22:47:11 PAGE    11

PCA0CPL2 . . . . .  D ADDR   00EBH   A      133#
PCA0CPL3 . . . . .  D ADDR   00EDH   A      135#
PCA0CPL4 . . . . .  D ADDR   00FDH   A      151#
PCA0CPM0 . . . . .  D ADDR   00DAH   A      116#
PCA0CPM1 . . . . .  D ADDR   00DBH   A      117#
PCA0CPM2 . . . . .  D ADDR   00DCH   A      118#
PCA0CPM3 . . . . .  D ADDR   00DDH   A      119#
PCA0CPM4 . . . . .  D ADDR   00DEH   A      120#
PCA0H. . . . . . .  D ADDR   00FAH   A      148#
PCA0L. . . . . . .  D ADDR   00F9H   A      147#
PCA0MD . . . . . .  D ADDR   00D9H   A      115# 291 292
PCA_INIT . . . . .  C ADDR   0112H   A      290#
PCON . . . . . . .  D ADDR   0087H   A      38#
PFE0CN . . . . . .  D ADDR   00AFH   A      76#
PS0. . . . . . . .  B ADDR   00B8H.4 A      193#
PSCTL. . . . . . .  D ADDR   008FH   A      46#
PSPI0. . . . . . .  B ADDR   00B8H.6 A      191#
PSW. . . . . . . .  D ADDR   00D0H   A      106# 220 221 222 223 224 225 226 227
PT0. . . . . . . .  B ADDR   00B8H.1 A      196#
PT1. . . . . . . .  B ADDR   00B8H.3 A      194#
PT2. . . . . . . .  B ADDR   00B8H.5 A      192#
PX0. . . . . . . .  B ADDR   00B8H.0 A      197#
PX1. . . . . . . .  B ADDR   00B8H.2 A      195#
RB80 . . . . . . .  B ADDR   0098H.2 A      175#
REF0CN . . . . . .  D ADDR   00D1H   A      107#
REG0CN . . . . . .  D ADDR   00C9H   A      101#
REN0 . . . . . . .  B ADDR   0098H.4 A      173#
RI0. . . . . . . .  B ADDR   0098H.0 A      177#
RS . . . . . . . .  B ADDR   00B0H.7 A      268# 316 360 398 415
RS0. . . . . . . .  B ADDR   00D0H.3 A      224#
RS1. . . . . . . .  B ADDR   00D0H.4 A      223#
RSTSRC . . . . . .  D ADDR   00EFH   A      137#
RXOVRN . . . . . .  B ADDR   00F8H.4 A      253#
S0MODE . . . . . .  B ADDR   0098H.7 A      170#
SBCON1 . . . . . .  D ADDR   00ACH   A      74#
SBRLH1 . . . . . .  D ADDR   00B5H   A      82#
SBRLL1 . . . . . .  D ADDR   00B4H   A      81#
SBUF0. . . . . . .  D ADDR   0099H   A      56#
SBUF1. . . . . . .  D ADDR   00D3H   A      109#
SCON0. . . . . . .  D ADDR   0098H   A      55# 170 172 173 174 175 176 177
SCON1. . . . . . .  D ADDR   00D2H   A      108#
SI . . . . . . . .  B ADDR   00C0H.0 A      207#
SMB0CF . . . . . .  D ADDR   00C1H   A      93#
SMB0CN . . . . . .  D ADDR   00C0H   A      92# 200 201 202 203 204 205 206 207
SMB0DAT. . . . . .  D ADDR   00C2H   A      94#
SMOD1. . . . . . .  D ADDR   00E5H   A      127#
SP . . . . . . . .  D ADDR   0081H   A      32#
SPI0CFG. . . . . .  D ADDR   00A1H   A      64#
SPI0CKR. . . . . .  D ADDR   00A2H   A      65#
SPI0CN . . . . . .  D ADDR   00F8H   A      146# 250 251 252 253 254 255 256 257
SPI0DAT. . . . . .  D ADDR   00A3H   A      66#
SPIEN. . . . . . .  B ADDR   00F8H.0 A      257#
SPIF . . . . . . .  B ADDR   00F8H.7 A      250#
STA. . . . . . . .  B ADDR   00C0H.5 A      202#
STO. . . . . . . .  B ADDR   00C0H.4 A      203#
T2CE . . . . . . .  B ADDR   00C8H.4 A      213#
T2CSS. . . . . . .  B ADDR   00C8H.1 A      216#
T2SPLIT. . . . . .  B ADDR   00C8H.3 A      214#
T2XCLK . . . . . .  B ADDR   00C8H.0 A      217#
TB80 . . . . . . .  B ADDR   0098H.3 A      174#
TCON . . . . . . .  D ADDR   0088H   A      39# 160 161 162 163 164 165 166 167
TF0. . . . . . . .  B ADDR   0088H.5 A      162#
TF1. . . . . . . .  B ADDR   0088H.7 A      160#
TF2H . . . . . . .  B ADDR   00C8H.7 A      210#
TF2L . . . . . . .  B ADDR   00C8H.6 A      211#
TF2LEN . . . . . .  B ADDR   00C8H.5 A      212#
A51 MACRO ASSEMBLER  LCD2                                                                 08/06/2007 22:47:11 PAGE    12

TH0. . . . . . . .  D ADDR   008CH   A      43#
TH1. . . . . . . .  D ADDR   008DH   A      44#
TI0. . . . . . . .  B ADDR   0098H.1 A      176#
TL0. . . . . . . .  D ADDR   008AH   A      41#
TL1. . . . . . . .  D ADDR   008BH   A      42#
TMOD . . . . . . .  D ADDR   0089H   A      40#
TMR2CN . . . . . .  D ADDR   00C8H   A      100# 210 211 212 213 214 215 216 217
TMR2H. . . . . . .  D ADDR   00CDH   A      105#
TMR2L. . . . . . .  D ADDR   00CCH   A      104#
TMR2RLH. . . . . .  D ADDR   00CBH   A      103#
TMR2RLL. . . . . .  D ADDR   00CAH   A      102#
TMR3CN . . . . . .  D ADDR   0091H   A      48#
TMR3H. . . . . . .  D ADDR   0095H   A      52#
TMR3L. . . . . . .  D ADDR   0094H   A      51#
TMR3RLH. . . . . .  D ADDR   0093H   A      50#
TMR3RLL. . . . . .  D ADDR   0092H   A      49#
TR0. . . . . . . .  B ADDR   0088H.4 A      163#
TR1. . . . . . . .  B ADDR   0088H.6 A      161#
TR2. . . . . . . .  B ADDR   00C8H.2 A      215#
TXBMT. . . . . . .  B ADDR   00F8H.1 A      256#
TXMODE . . . . . .  B ADDR   00C0H.6 A      201#
USB0ADR. . . . . .  D ADDR   0096H   A      53#
USB0DAT. . . . . .  D ADDR   0097H   A      54#
USB0XCN. . . . . .  D ADDR   00D7H   A      113#
VDM0CN . . . . . .  D ADDR   00FFH   A      153#
WCOL . . . . . . .  B ADDR   00F8H.6 A      251#
XBR0 . . . . . . .  D ADDR   00E1H   A      123# 283
XBR1 . . . . . . .  D ADDR   00E2H   A      124# 284
XBR2 . . . . . . .  D ADDR   00E3H   A      125#


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
